<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Web-Ported - WebGL ports</title>
<link rel="icon" href="favicon.png" type="image/png">

<script async defer src="https://cdn.jsdelivr.net/npm/@widgetbot/crate@3"></script>

<meta property="og:title" content="WannaSmile" />
<meta property="og:description" content="Welcome to WannaSmile — a library full of content! Enjoy it in your free time." />
<meta property="og:image" content="https://www.yourwebsite.com/path/to/your/preview-image.jpg" />
<meta property="og:url" content="https://vvannasmile.github.io/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="WannaSmile.github.io" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="WannaSmile" />
<meta name="twitter:description" content="A fun, content-filled library to make you smile." />
<meta name="twitter:image" content="https://www.yourwebsite.com/path/to/your/preview-image.jpg" />

<link href="https://unpkg.com/cropperjs@1.6.2/dist/cropper.min.css" rel="stylesheet">
<script src="https://unpkg.com/cropperjs@1.6.2/dist/cropper.min.js"></script>
<link rel="stylesheet" href="style.css">
</head>
<body id="pageBody">

<div id="loadingOverlay">
  <div class="loading-info">
    <div class="loading-text">Loading...</div>
    <div id="loadingPercent" class="loading-percentage">0%</div>
    <div class="loading-bar-container">
      <div id="progressBar" class="loading-bar"></div>
    </div>
  </div>
</div>

<header>
  <div class="header-left">
    <div class="brand">
      <img src="webgL.png" alt="Site Logo">
    </div>
    <nav>
      <a href="#" id="homeLink">Home</a>
      <a href="#" id="aboutLink">About</a>
      <a href="#" id="settingsLink">Settings</a>
      <a href="#" id="contactLink">Contact</a>
    </nav>
  </div>
  <div class="search-wrap">
    <div class="search-box">
      <input type="text" id="liveSearch" placeholder="Search ports...">
      <img src="search.png" class="icon" alt="search">
    </div>
    <div class="profile-icon" id="profileIcon" title="Open profile">
      <img id="profileImage" src="profile.png" alt="profile">
    </div>
    <button id="dashBtn" class="dashboard-btn">
      <span class="dash-icon"><div></div><div></div><div></div></span>
    </button>
  </div>
</header>

<h1 id="welcomeMessage">Loading welcome message...</h1>
<div id="thoughtSpeaker">
  <img src="thoth.png" alt="speaker" />
</div>

<main id="mainContent">
  <div id="homePage">
    <div id="portContainer"></div>
  </div>
  <div id="aboutPage" style="display:none;">
    <div class="glass-panel"><h2>About</h2><p>About page goes here.</p></div>
  </div>
  <div id="settingsPage" style="display:none;"></div>
  <div id="contactPage" style="display:none;">
    <div class="glass-panel"><h2>Contact</h2><p>Contact page goes here.</p></div>
  </div>
</main>

<div id="dashboardPanel" class="dashboard-panel">
  <p>pages</p>
  <a href="https://bguhm.github.io/music-player.html" target="_blank">Music Player</a>
  <a href="system/pages/settings-themes.html" target="_blank">Themes</a>
  <a href="system/pages/credits.html" target="_blank">Credits</a>
  <p>dev tools</p>
  <a href="#">Console</a>
  <a href="#">Inspector</a>
</div>

<hr>
<footer>
  <a href="#">discord</a>
  <a href="#">suggestions & bug fixes</a>
  <a href="#">version: v0.1</a>
  <a href="#">other projects</a>
</footer>

<div id="profileModal" aria-hidden="true">
  <div id="profileModalContent" role="dialog" aria-modal="true">
    <h3>Edit Profile</h3>
    <img id="profileLarge" class="profile-large" src="profile.png" alt="Profile preview">
    <div>
      <input type="file" id="profilePicInput" accept="image/*" />
    </div>
    <div id="cropContainer">
      <img id="cropPreview" alt="Crop preview" />
      <div style="margin-top:8px;">
        <button class="modal-btn save-btn" id="cropConfirm">Crop</button>
        <button class="modal-btn cancel-btn" id="cropCancel">Cancel</button>
      </div>
    </div>
    <div style="margin-top:12px;">
      <button class="modal-btn remove-btn" id="removePicBtn">Remove picture</button>
    </div>
    <div style="margin-top:12px;">
      <input type="text" id="usernameInput" placeholder="Enter nickname" />
    </div>
    <div style="margin-top:14px;">
      <button class="modal-btn save-btn" id="saveProfileBtn">Save changes</button>
      <button class="modal-btn cancel-btn" id="closeProfileBtn">Close</button>
    </div>
  </div>
</div>

<script>
window.addEventListener('DOMContentLoaded', function(){

  var loadingOverlay = document.getElementById('loadingOverlay');
  var progressBar = document.getElementById('progressBar');
  var loadingPercent = document.getElementById('loadingPercent');

  function updateProgress(p){ progressBar.style.width = Math.min(100, Math.max(0, p)) + '%'; loadingPercent.textContent = Math.round(Math.min(100, Math.max(0, p))) + '%'; }
  function completeLoading(){ updateProgress(100); setTimeout(function(){ loadingOverlay.classList.add('hidden'); }, 400); }

  var progress = 0;
  var loadingInterval = setInterval(function(){
    if (progress >= 90){ clearInterval(loadingInterval); return; }
    progress += Math.random() * 5 + 2;
    updateProgress(progress);
  }, 150);

  var pageBody = document.getElementById('pageBody');
  function applySavedBackground(){
    var bg = localStorage.getItem('selectedBackground');
    if(!bg || bg === 'background'){ pageBody.className = ''; return; }
    pageBody.className = 'bg-' + bg;
  }
  applySavedBackground();

  var homePage = document.getElementById('homePage');
  var aboutPage = document.getElementById('aboutPage');
  var settingsPage = document.getElementById('settingsPage');
  var contactPage = document.getElementById('contactPage');

  function showPage(p){
    homePage.style.display = 'none';
    aboutPage.style.display = 'none';
    settingsPage.style.display = 'none';
    contactPage.style.display = 'none';
    p.style.display = 'block';
  }

  var portContainer = document.getElementById('portContainer');
  var allPorts = [];

  function renderPorts(list){
    portContainer.innerHTML = '';
    list.forEach(function(item){
      var a = document.createElement('a');
      a.className = 'port-card-link';
      a.href = item.link;
      var card = document.createElement('div');
      card.className = 'port-card';
      var img = document.createElement('img');
      img.src = item.image;
      var h2 = document.createElement('h2');
      h2.textContent = item.title;
      card.appendChild(img);
      card.appendChild(h2);
      a.appendChild(card);
      portContainer.appendChild(a);
    });
  }

  var portsLoaded = false;
  fetch('ports.json').then(function(r){ return r.json(); }).then(function(data){
    allPorts = data;
    renderPorts(allPorts);
    portsLoaded = true;
    clearInterval(loadingInterval);
    completeLoading();
  }).catch(function(err){
    console.error('Error fetching ports.json:', err);
    portsLoaded = true;
    clearInterval(loadingInterval);
    completeLoading();
  });

  setTimeout(function(){
    if(!portsLoaded){
      portsLoaded = true;
      clearInterval(loadingInterval);
      completeLoading();
    }
  }, 8000);

  document.getElementById('liveSearch').addEventListener('input', function(e){
    var q = e.target.value.toLowerCase();
    renderPorts(allPorts.filter(function(p){ return p.title.toLowerCase().includes(q); }));
  });

  var dashBtn = document.getElementById('dashBtn');
  var dashPanel = document.getElementById('dashboardPanel');
  dashBtn.addEventListener('click', function(){ dashPanel.classList.toggle('open'); });
  document.addEventListener('click', function(e){ if(!dashPanel.contains(e.target) && !dashBtn.contains(e.target)) dashPanel.classList.remove('open'); });

  document.getElementById('homeLink').addEventListener('click', function(e){ e.preventDefault(); showPage(homePage); renderPorts(allPorts); });
  document.getElementById('aboutLink').addEventListener('click', function(e){ e.preventDefault(); showPage(aboutPage); });
  document.getElementById('settingsLink').addEventListener('click', function(e){ e.preventDefault(); loadSettingsPage(); showPage(settingsPage); });
  document.getElementById('contactLink').addEventListener('click', function(e){ e.preventDefault(); showPage(contactPage); });

  function loadSettingsPage(){
    settingsPage.innerHTML = '<div class="glass-panel"><h2>⚙️ Settings</h2><p>Background Image Selection</p><div class="bg-button-container"><button class="bg-button" data-bg="background">Default</button><button class="bg-button" data-bg="graduation">Graduation</button><button class="bg-button" data-bg="checkerboard">Checkerboard</button><button class="bg-button" data-bg="creepybg">Creepy BG</button><button class="bg-button" data-bg="sillybg">Silly BG</button></div></div>';
    var bgButtons = settingsPage.querySelectorAll('.bg-button');
    var savedBG = localStorage.getItem('selectedBackground') || 'background';
    bgButtons.forEach(function(btn){ if(btn.dataset.bg === savedBG) btn.classList.add('active'); });
    bgButtons.forEach(function(btn){
      btn.addEventListener('click', function(){
        pageBody.className = '';
        bgButtons.forEach(function(b){ b.classList.remove('active'); });
        this.classList.add('active');
        var bgName = this.dataset.bg;
        if(bgName !== 'background') pageBody.classList.add('bg-' + bgName);
        localStorage.setItem('selectedBackground', bgName);
      });
    });
  }

  var profileIcon = document.getElementById('profileIcon');
  var profileModal = document.getElementById('profileModal');
  var profileLarge = document.getElementById('profileLarge');
  var profileImageElement = document.getElementById('profileImage');
  var profilePicInput = document.getElementById('profilePicInput');
  var cropContainer = document.getElementById('cropContainer');
  var cropPreview = document.getElementById('cropPreview');
  var cropConfirm = document.getElementById('cropConfirm');
  var cropCancel = document.getElementById('cropCancel');
  var removePicBtn = document.getElementById('removePicBtn');
  var usernameInput = document.getElementById('usernameInput');
  var saveProfileBtn = document.getElementById('saveProfileBtn');
  var closeProfileBtn = document.getElementById('closeProfileBtn');
  var defaultPic = 'profile.png';
  var cropper = null;
  var croppedImageData = null;

  function loadProfileData(){
    var savedPic = localStorage.getItem('profilePic') || defaultPic;
    var savedName = localStorage.getItem('nickname') || '';
    profileImageElement.src = savedPic;
    profileLarge.src = savedPic;
    usernameInput.value = savedName;
  }
  loadProfileData();

  profileIcon.addEventListener('click', function(){
    mainContent = document.getElementById('mainContent');
    mainContent.style.display = 'none';
    profileModal.style.display = 'flex';
  });

  function closeProfileModal(){
    profileModal.style.display = 'none';
    mainContent = document.getElementById('mainContent');
    mainContent.style.display = 'block';
    if(cropper){ cropper.destroy(); cropper = null; }
    cropContainer.style.display = 'none';
    profilePicInput.value = '';
    croppedImageData = null;
    loadProfileData();
  }
  closeProfileBtn.addEventListener('click', closeProfileModal);
  profileModal.addEventListener('click', function(e){ if(e.target === profileModal) closeProfileModal(); });

  removePicBtn.addEventListener('click', function(){
    profileLarge.src = defaultPic;
    profileImageElement.src = defaultPic;
    localStorage.setItem('profilePic', defaultPic);
  });

  profilePicInput.addEventListener('change', function(e){
    var file = e.target.files[0];
    if(!file) return;
    var reader = new FileReader();
    reader.onload = function(ev){
      cropContainer.style.display = 'block';
      cropPreview.src = ev.target.result;
      if(cropper) cropper.destroy();
      cropper = new Cropper(cropPreview, { aspectRatio:1, viewMode:1, dragMode:'move', background:false, cropBoxResizable:true });
    };
    reader.readAsDataURL(file);
  });

  cropConfirm.addEventListener('click', function(){
    if(!cropper) return;
    var canvas = cropper.getCroppedCanvas({ width:300, height:300 });
    croppedImageData = canvas.toDataURL('image/png');
    profileLarge.src = croppedImageData;
    cropper.destroy();
    cropper = null;
    cropContainer.style.display = 'none';
    profilePicInput.value = '';
  });

  cropCancel.addEventListener('click', function(){
    if(cropper) cropper.destroy();
    cropper = null;
    cropContainer.style.display = 'none';
    profilePicInput.value = '';
  });

  saveProfileBtn.addEventListener('click', function(){
    var name = usernameInput.value.trim();
    if(name) localStorage.setItem('nickname', name);
    var finalImg = croppedImageData || profileLarge.src || defaultPic;
    localStorage.setItem('profilePic', finalImg);
    profileImageElement.src = finalImg;
    croppedImageData = null;
    closeProfileModal();
    setTimeout(updateWelcomeMessage, 150);
  });

  var welcomeEl = document.getElementById('welcomeMessage');
  function updateWelcomeMessage(){
    var username = localStorage.getItem('nickname') || 'User';
    fetch('site-info.json').then(function(r){ return r.json(); }).then(function(info){
      welcomeEl.textContent = info.message.replace('{username}', username).replace('{version}', info.version);
    }).catch(function(err){
      welcomeEl.textContent = 'Welcome ' + username + '!';
    });
  }
  updateWelcomeMessage();

  function initCrate(){
    if(typeof Crate !== 'undefined'){
      new Crate({ server: '1439699996676063357', channel: '1439699997758066774' });
    } else {
      setTimeout(initCrate, 200);
    }
  }
  initCrate();

});
</script>

</body>
</html>
