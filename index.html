<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Web-Ported - WebGL ports</title>
<style>
:root{
  --bg: #000000;
  --text: #ffffff;
  --accent: #ff3b3b;
  --muted: #bdbdbd;
}

*{ box-sizing: border-box; }
html, body{ height:100%; margin:0; padding:0; }

body{
  font-family: Inter, system-ui, sans-serif;
  color: var(--text);
  display:flex;
  flex-direction:column;
  min-height:100vh;
  background-image: url("background.png");
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center 0%;
  background-color: black;
}

/* HEADER + FOOTER glow */
header, footer {
  text-shadow: 0 0 6px rgba(255,255,255,0.55);
}

/* -----------------------------
   GLASS CARD (BASE)
----------------------------- */
.port-card{
  border:1px solid rgba(255,255,255,0.12);
  padding:1rem;
  border-radius:12px;
  backdrop-filter: blur(12px) saturate(120%);
  -webkit-backdrop-filter: blur(12px) saturate(120%);
  background: rgba(0,0,0,0.32);
  margin-bottom:1rem;
  color:var(--text);
  transition: 
    transform .28s cubic-bezier(.25,.9,.3,1.08),
    background .22s ease,
    box-shadow .28s ease;
  transform-origin: center center; /* keeps card in same place */
}

/* -----------------------------
   CARD HOVER — smooth grow, glow
----------------------------- */
.port-card-link:hover .port-card{
  transform: scale(1.1);
  background: rgba(0,0,0,0.40);
  box-shadow: 0 0 22px rgba(255,255,255,0.12);
}

/* smaller images */
.port-card img{
  width:100%;
  height:150px;
  object-fit:cover;
  border-radius:8px;
  margin-bottom:0.5rem;
  display:block;
}

/* keep text hover color, remove scale */
.port-card h2{
  text-align:center;
  margin:0;
  padding:0.35rem 0 0;
  font-size:1.05rem;
  color:var(--text);
  transition: color .16s ease;
}
.port-card h2:hover{
  color: var(--accent);
}

/* clickable block */
.port-card-link{
  display:block;
  text-decoration:none;
  color:var(--text);
}

/* disable old hover movement */
.port-card.title-hover { transform:none !important; }

/* dashboard glass */
.dashboard-panel{
  background:rgba(0,0,0,0.38);
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.12);
}

/* footer links */
footer{
  text-align:center;
  padding:1rem;
}
footer a{
  color:white;
  text-shadow:0 0 6px rgba(255,255,255,0.6);
  margin:0 10px;
  text-decoration:none;
  font-size:0.95rem;
}
footer a:hover{
  color:var(--accent);
}
</style>
</head>
<body>

  <header>
    <div class="brand">
      <img src="webgL.png" alt="Site Logo">
    </div>

    <nav>
      <a href="#">Home</a>
      <a href="#">About</a>
      <a href="#">Contact</a>
    </nav>

    <!-- White 3-dash hamburger (square) -->
    <button id="dashBtn" class="dashboard-btn" aria-controls="dashPanel" aria-expanded="false" title="Open dashboard">
      <span class="dash-icon" aria-hidden="true">
        <div></div><div></div><div></div>
      </span>
    </button>
  </header>

  <div id="dashPanel" class="dashboard-panel" role="menu" aria-hidden="true">
    <a href="#" role="menuitem">Settings</a>
    <a href="#" role="menuitem">Account</a>
    <a href="#" role="menuitem">Tools</a>
    <a href="#" role="menuitem">Dev Options</a>
  </div>

  <main>
    <section class="card">
      <h1>Welcome to Web-Ported!</h1>
      <p>webports downloaded from gn-math, credits to genizy &lt;3</p>
    </section>

    <div id="portContainer" aria-live="polite"></div>
  </main>

<footer>
  <a href="#">version: v0.1</a><br>
  <a href="#">discord</a><br>
  <a href="#">suggestions & bug fixes</a><br>
  <a href="#">other projects</a>
  <br>
  © <span id="year"></span>
</footer>


  <script>
    // safe DOM-ready wrapper
    (function () {
      // set year
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      /* ---------------------------
         Dropdown logic (robust)
      ----------------------------*/
      const dashBtn = document.getElementById('dashBtn');
      const dashPanel = document.getElementById('dashPanel');

      function openPanel() {
        dashPanel.classList.add('open');
        dashPanel.setAttribute('aria-hidden', 'false');
        dashBtn.setAttribute('aria-expanded', 'true');
      }
      function closePanel() {
        dashPanel.classList.remove('open');
        dashPanel.setAttribute('aria-hidden', 'true');
        dashBtn.setAttribute('aria-expanded', 'false');
      }
      function togglePanel() {
        dashPanel.classList.contains('open') ? closePanel() : openPanel();
      }

      if (dashBtn && dashPanel) {
        dashBtn.addEventListener('click', function (e) {
          e.stopPropagation();
          togglePanel();
        });

        // close when clicking outside
        document.addEventListener('click', function (e) {
          if (!dashPanel.contains(e.target) && !dashBtn.contains(e.target)) {
            closePanel();
          }
        });

        // keyboard: Escape closes
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape') closePanel();
        });
      }

      /* ---------------------------
         Background scroll (resilient)
         - slowFactor controls how much the background moves relative to page scroll
         - clamp prevents image leaving the viewport
      ----------------------------*/
      function updateBackgroundScroll() {
        try {
          const scrollTop = window.scrollY || window.pageYOffset || 0;
          const docHeight = Math.max(document.body.scrollHeight - window.innerHeight, 0);

          // if page has no scroll, keep at top
          let scrollPercent = docHeight > 0 ? (scrollTop / docHeight) : 0;

          // slower movement factor (smaller = slower)
          const slowFactor = 0.22;

          // compute limited percent and clamp between 0 and slowFactor
          let mapped = Math.min(Math.max(scrollPercent * slowFactor, 0), slowFactor);

          // convert to percentage for background-position
          const yPercent = mapped / slowFactor * (slowFactor * 100); // yields 0..(slowFactor*100)
          // simpler: just use mapped*100
          document.body.style.backgroundPosition = 'center ' + (mapped * 100) + '%';
        } catch (err) {
          // don't break page if something odd happens
          console.error('bg scroll error', err);
        }
      }

      window.addEventListener('scroll', updateBackgroundScroll, { passive: true });
      window.addEventListener('resize', updateBackgroundScroll);
      // initial
      updateBackgroundScroll();

      /* ---------------------------
         Load ports.json and build cards
      ----------------------------*/
      const portContainer = document.getElementById('portContainer');

      function makeCard(item) {
        // wrapper anchor
        const a = document.createElement('a');
        a.className = 'port-card-link';
        // guard empty link: if empty, link to '#' and don't open new tab
        a.href = item.link && item.link.trim() ? item.link : '#';
        if (item.link && item.link.trim()) a.target = '_blank';
        a.rel = 'noopener noreferrer';

        const card = document.createElement('div');
        card.className = 'port-card';

        // image element (use provided image path)
        const img = document.createElement('img');
        img.src = item.image || 'icon.png';
        img.alt = item.title || 'item';
        img.loading = 'lazy';

        const h2 = document.createElement('h2');
        h2.textContent = item.title || '';

        // hover interactivity: when title hovered, make parent card more opaque
        h2.addEventListener('mouseenter', () => card.classList.add('title-hover'));
        h2.addEventListener('mouseleave', () => card.classList.remove('title-hover'));

        card.appendChild(img);
        card.appendChild(h2);
        a.appendChild(card);

        return a;
      }

      // fetch with graceful fallback
      (function loadPorts() {
        if (!portContainer) return;
        fetch('ports.json', { cache: 'no-store' })
          .then(res => {
            if (!res.ok) throw new Error('Network response was not ok');
            return res.json();
          })
          .then(data => {
            if (!Array.isArray(data)) throw new Error('ports.json is not an array');
            // clear container
            portContainer.innerHTML = '';
            data.forEach(item => {
              try {
                const node = makeCard(item);
                portContainer.appendChild(node);
              } catch (err) {
                console.error('card build error', err, item);
              }
            });
          })
          .catch(err => {
            console.warn('Failed to load ports.json — showing placeholder:', err);
            // fallback: show a friendly placeholder card
            portContainer.innerHTML = `
              <div class="card">
                <strong>Could not load ports.json</strong>
                <p>Check console for details. Place a valid <code>ports.json</code> file in the site root (array of {image,title,link}).</p>
              </div>
            `;
          });
      })();

    })();
  </script>
</body>
</html>
